University: ITMO University
Faculty: FICT
Course: Network programming
Year: 2022/2023
Group: K34202
Author: Kudinov Alexander Vadimovich
Lab: Lab3
Date of create: 27.11.2022
Date of finished:

Цель: С помощью Ansible и Netbox собрать всю возможную информацию об устройствах и сохранить их в отдельном файле.

Ход работы:

Вначале был поднят Ubuntu на новой виртуальной машине. По аналогии со второй лабороторной работой данная виртуальная машина была соединена с вритуальной машиной, размещенной в облаке Яндекса, используя OVPN туннель.

Затем был установлен и запущен Postgresql с помощью следующих команд:

sudo apt update
sudo apt install -y postgresql
sudo systemctl start postgresql
sudo systemctl enable postgresql

![image](https://user-images.githubusercontent.com/42407837/204133376-cfdac721-29ca-41b9-b4c9-240f2c90a4e9.png)

Рисунок 1 - Установка Postgresql.

Затем была создана база данных для Netbox (Рисунок 2).

![image](https://user-images.githubusercontent.com/42407837/204133591-2cd93ac7-cc46-48e0-9263-4691d8966ab1.png)

Рисунок 2 - Создание базы данных

Далее был установлен Reddis, а также Netbox (Рисунки 3 и 4).

![image](https://user-images.githubusercontent.com/42407837/204133690-cf2ac012-537c-43e7-a930-6ee9c201ce94.png)

Рисунок 3 - Установка Reddis

![image](https://user-images.githubusercontent.com/42407837/204133933-7eddf55f-5ee2-407f-a3bc-33ca24b9e4cf.png)

Рисунок 4 - Установка Netbox

Затем была склонирована ветка репозитория NetBox из GitHub. Но перед этим была установлена команда git, поскольку ее не оказалось на виртуальной машине.

Далее была создана системная учетная запись пользователя с именем Netbox с помощью следующих команд:
sudo adduser --system --group netbox
sudo chown --recursive netbox /opt/netbox/netbox/media/

Затем была создана виртуальная среда Python, а также был создан суперпользователь для авторировации в Netbox. Наконец, сервер Netbox был запущен.

Был установлен и запущен nginx, после чего Netbox был открыт через браузер (Рисунок 6).

![image](https://user-images.githubusercontent.com/42407837/209428090-e3bf0080-d4f8-4e3f-95f0-8da3a8e7f543.png)

Рисунок 6 - Подключение к Netbox

Затем была внесена информация о двух роутерах (Рисунок 7). Для внесения IP адреса пришлось создать интерфейсы.

![image](https://user-images.githubusercontent.com/42407837/204134835-5c548e2d-ec52-4d29-b9b1-d4b4d9404ede.png)

Рисунок 7 - Внесение информации о роутерах

Далее была проделана работа с плейбуком - был спарсен csv файл, а также была записана информацию о роутере в отдельный файл (Рисунок 8). В данном случае за ключ был взят UID роутера, так как это значение не будет изменено.

![image](https://user-images.githubusercontent.com/42407837/204135156-a34e7b91-3a24-4021-946b-3f0c31d9f13a.png)

Рисунок 8 - Файл с информацией из Netbox

Далее сценарий был запущен для тестирования правильности вывода (Рисунок 9).

![image](https://user-images.githubusercontent.com/42407837/204135230-77fafa2e-bfab-41c8-bd50-4193c05cb188.png)

Рисунок 9 - Тестирование сценария

Затем плейбук был запущен целиком. Имя роутера берется из csv файла, сгенерированного Netbox. Далее это имя присваивается подключенному роутеру. Вывод результатов представлен на рисунке 10. Также в результате имя роутера в консоли микротика было изменено (Рисунок 11).

![image](https://user-images.githubusercontent.com/42407837/204135347-13ac66ac-0a71-45f0-9500-f606342b9ca6.png)

Рисунок 10 - Вывод результатов

![image](https://user-images.githubusercontent.com/42407837/204135398-c08d15a1-e191-49a3-86cd-fb113bb5a3e7.png)

Рисунок 11 - Изменение названия в микротике

Была реализована часть задания, в которой информация достаётся из микротика и передаётся в файл на виртуальной машине в облаке (Рисунок 12). Затем данная информация была внесена в Netbox. В результате был создан девайс, в котором часть настроек предопределено, а имя берется из Микротика.

![image](https://user-images.githubusercontent.com/42407837/204135453-f30bf056-c98a-4f6e-856d-5f0db734ce0c.png)

Рисунок 12 - Файл с названием роутеров 

Наконец, был запущен итоговый файл, в результате чего был произведен корректный вывод от ansible (Рисунок 13).

![image](https://user-images.githubusercontent.com/42407837/204135859-2b954ec3-4cb3-4df3-881a-dcd5225f8d5b.png)

Рисунок 13 - Проверка работоспособности

Вывод: 
В результате выполнения лабороторной работы было произведено ознакомление с достаточно гибким инструментом для документирования сетей - Netbox. Также с помощью ansible была произведена автоматизация процессов.
